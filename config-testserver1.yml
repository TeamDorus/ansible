---
- name: Playbook to configure the host "testserver1"
  hosts: testserver1

  # wait with gathering facts until host is up and running
  # fact gathering will be done in role " basic_lxc"
  gather_facts: true


  tasks:

    - include_role:
        name: docker
      vars:
        ansible_become: true   # install as root

    - include_role:
        name: config_portainer_endpoint_create


    - name: Start dummy container
      docker_container:
        name: dummy
        image: hello-world
        state: present
      ignore_errors: true


    - name: Reboot remote server
      reboot:
      vars:
        ansible_become: true   # reboot as root


    - name: Wait for docker service to be up and running
      wait_for:
        host: localhost
        port: 2375


    - include_role:
        name: docker_heimdall


    - include_role:
        name: docker_telegraf
